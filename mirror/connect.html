<!doctype html>
<html>
<head>
    <title>Connect SDK Web App</title>
</head>
<body>
    <video id="video" class="media" autoplay></video>
	<div id="textContainer">
		<div id="textMessage">App is loading...</div>
	</div>
    <script src="//www.gstatic.com/cast/sdk/libs/receiver/2.0.0/cast_receiver.js"></script>
    <script src="connect.js"></script>
    <script>
        window.onload = function() {
            var mimeType = getParameterByName('mimeType');
			var mediaElement;
			if (mimeType) {
				var mediaType = mimeType.split('/')[0];
				if (mediaType) {
					mediaElement = document.getElementById(mediaType);
                }
			} else {
				mediaElement = document.getElementById('video');
			}

			window.connectManager = new connectsdk.ConnectManager();
            window.connectManager.setMediaElement(mediaElement);

            var cleanupVideo = function() {
				if (mediaElement.playbackRate != 0)
					mediaElement.pause();

				mediaElement.style.display = 'none';
			};

			var textContainer = document.getElementById('textContainer');
			var textElement = document.getElementById('textMessage');

			window.connectManager.on('ready', function(evt) {
				textElement.innerText = "Ready to receive messages";
			});

            window.connectManager.on('message', function(data) {
					var from = data.from;
					var message = data.message;
					var messageString;
					var isJSON = false;

					if (typeof message == "string")
					{
						messageString = message;
					} else if (typeof message == "object")
					{
						messageString = JSON.stringify(message);
						isJSON = true;
					}

					textContainer.style.display = 'table';
					textElement.innerText = messageString;

					if (isJSON)
						window.connectManager.sendMessage(from, {message:"I got your JSON message :-)"});
					else
						window.connectManager.sendMessage(from, "I got your message :-)");
				});

            window.connectManager.init();
        };
    </script>
</body>
</html>
